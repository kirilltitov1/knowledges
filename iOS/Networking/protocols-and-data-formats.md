## Протоколы и форматы данных в iOS‑сетевом стеке

Этот обзор помогает быстро выбрать подходящую технологию для клиент‑сервера на iOS и понять, чем отличаются REST, gRPC, GraphQL, WebSocket, RTP, а также форматы JSON и Protobuf.

### Быстрые рекомендации
- **REST + JSON**: дефолт для бóльшества мобильных приложений, кэшируемость, простота, зрелая экосистема.
- **WebSocket**: двунаправленная коммуникация и realtime‑события (чаты, presence, лайвы). В iOS используйте `URLSessionWebSocketTask`.
- **gRPC + Protobuf**: высокопроизводительные бинарные RPC, компактность, стриминг по HTTP/2. Хорошо для микросервисов и «толстых» API‑шлюзов.
- **GraphQL**: гибкие выборки «ровно тех» полей. Полезно при сложных экранах и агрегированных данных.
- **RTP**: низкая задержка для медиа (голос/видео) через стек WebRTC. Для VOD/live чаще **HLS/LL‑HLS** на iOS.
- **Protobuf**: бинарный формат для gRPC или автономного обмена, экономит трафик и ускоряет сериализацию.

### Что изучить в первую очередь iOS‑разработчику
- [REST](rest-api.md) и [JSON](json.md): модели `Codable`, стратегии дат/кейсов, ошибки и ретраи, кэш/ETag.
- [WebSocket](websocket.md): reconnection, backoff, ping/pong, idempotency.
- [gRPC](grpc.md) и [Protobuf](protobuf.md): генерация кода, таймауты, TLS/ALPN, маппинг ошибок.
- [GraphQL](graphql.md): схемы, типобезопасные запросы, фрагменты, кеширование клиента.
- [RTP](rtp.md): понимать, что в iOS почти всегда используется WebRTC/HLS, а не «сырой» RTP.

### Краткая карта выбора
- **Нужен realtime (двунаправленный канал)** → WebSocket; если медиа‑звонки → WebRTC (RTP под капотом).
- **Нужна компактность и скорость RPC** → gRPC + Protobuf.
- **Нужна гибкая агрегация и нестабильные требования к данным** → GraphQL.
- **Обычные CRUD/HTTP, легкая кэшируемость** → REST + JSON.
- **Стриминг видео пользователям** → HLS/LL‑HLS на iOS (а не чистый RTP).

### Сравнение технологий
| Технология | Транспорт | Формат | Основные кейсы | Плюсы | Минусы | iOS‑заметки |
|---|---|---|---|---|---|---|
| REST | HTTP/1.1/2 | JSON (часто) | CRUD, публичные API | Простота, кеши, инструменты | Чаттер, избыточные поля | Стабильно через `URLSession` |
| gRPC | HTTP/2 | Protobuf | Высокая производительность RPC, стримы | Быстро, компактно, двунаправленные стримы | Генерация кода, DevOps сложнее | gRPC‑Swift (NIO), TLS/ALPN |
| GraphQL | HTTP/1.1/2 | JSON | Гибкие выборки, агрегированные экраны | Запрашиваем только нужные поля | Сложность схемы/серверной валидации | Apollo iOS, нормализация кэша |
| WebSocket | TCP (WS over HTTP) | Любой (часто JSON/Protobuf) | Realtime‑ивенты, двусторонний канал | Мгновенные события, сервер‑push | Поддержка протокола на бэкенде | `URLSessionWebSocketTask` |
| RTP | UDP | Аудио/видео payload | Голос/видео с низкой задержкой | Минимальная латентность | Сложно, NAT, QoS, нет «из коробки» | На iOS — WebRTC/HLS |
| JSON | — | Текстовый | Универсальный обмен данными | Читаемость, инструменты | Объемнее/медленнее Protobuf | `Codable`, стратегии дат/кейсов |
| Protobuf | — | Бинарный | Компактные модели и RPC | Быстро и компактно | Генерация, бинарные diff | SwiftProtobuf, versioning |

### Навигация по материалам
- REST: [rest-api.md](rest-api.md)
- gRPC: [grpc.md](grpc.md)
- GraphQL: [graphql.md](graphql.md)
- WebSocket: [websocket.md](websocket.md)
- RTP/WebRTC/HLS: [rtp.md](rtp.md)
- JSON (Codable): [json.md](json.md)
- Protobuf: [protobuf.md](protobuf.md)

### Практические принципы для iOS
- **Надежность**: экспоненциальный backoff, идемпотентность, повторные попытки, circuit breaker на клиентах realtime.
- **Производительность**: батчинг, компрессия, HTTP/2, ограничение concurrent‑запросов, стриминг/чанкование.
- **Эволюция API**: обратная совместимость схем (optional‑поля, versioning), feature‑флаги.
- **Безопасность**: TLS 1.2+, SSL‑pinning при необходимости, защита токенов, минимизация логов с PII.
- **Наблюдаемость**: корелляция запросов (trace‑id), метрики сети, structured‑логирование, диагностика ошибок.


