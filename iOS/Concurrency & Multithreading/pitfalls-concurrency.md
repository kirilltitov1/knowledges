---
type: "thread"
status: "draft"
summary: "Проблемы многопоточности"
title: "Проблемы многопоточности"
---

## Common Problems
- Deadlock
- Livelock
- Priority inversion
- Thread explosion
- Data race
- Race condition
- Starvation

## Ссылки и примеры
#### Deadlock
```swift
// main.sync из main → взаимная блокировка
DispatchQueue.main.sync { }

// sync на ту же серийную очередь
let q = DispatchQueue(label: "q")
q.async { q.sync { /* deadlock */ } }
```

#### Livelock
```swift
// Две задачи вежливо уступают ресурсы друг другу, прогресса нет
// Решение: ограничение ретраев/случайная задержка/приоритеты
```

#### Priority inversion
```swift
// Низкий QoS держит ресурс, высокий ждёт
// Решение: корректный QoS, избегать длинных критических секций
```
#### Thread explosion
```swift
// Сотни/тысячи параллельных задач → контекст‑свитчи
// Решение: семафор/ограничение параллелизма/батчинг
```
#### Data race
```swift
// Доступ к общему стейту без синхронизации
// Решение: акторы/барьеры/локи/неизменяемость
```
#### Race condition
```swift
// Неконтролируемый порядок событий вызывает баг
// Решение: сериализация/await последовательность/барьеры
```
#### Starvation
```swift
// Задача вытесняется более приоритетными и не получает времени
// Решение: баланс QoS, ограничить долгие задачи высокого приоритета
```
## Вопросы собеседований
1. Приведи пример deadlock в GCD и как его избежать.
2. Объясни priority inversion и способы смягчения.
3. Чем data race отличается от race condition?
4. Как диагностировать гонки и дедлоки (TSan, Instruments)?


