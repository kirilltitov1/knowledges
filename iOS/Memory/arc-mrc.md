---
title: ARC vs MRC
type: thread
topics: [Memory Management, ARC]
subtopic: ARC & MRC
status: draft
level: intermediate
platforms: [iOS, macOS, watchOS, tvOS]
ios_min: "10.0"
duration: 30m
tags: [memory-management, automatic-reference-counting, manual-reference-counting, retain-cycles]
---

# ARC vs MRC

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ ARC (Automatic Reference Counting)?
**ARC** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –≤ Swift –∏ Objective-C, –≥–¥–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã–∑–æ–≤—ã `retain`, `release` –∏ `autorelease` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.

### –ß—Ç–æ —Ç–∞–∫–æ–µ MRC (Manual Reference Counting)?
**MRC** ‚Äî —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ Objective-C, –≥–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `retain`, `release` –∏ `autorelease` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –æ–±—ä–µ–∫—Ç–æ–≤.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ARC

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
1. **–°–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (strong references)**: –û–±—ä–µ–∫—Ç—ã —Å —Å–∏–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏
2. **–°–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ (weak references)**: –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–∞
3. **–ù–µ–Ω–∞–¥–µ–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (unowned references)**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã —Å–ª–∞–±—ã–º, –Ω–æ –Ω–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Å—ã–ª–æ–∫
```swift
class Person {
    var name: String
    var passport: Passport? // strong reference

    init(name: String) {
        self.name = name
        print("Person \(name) initialized")
    }

    deinit {
        print("Person \(name) deinitialized")
    }
}

class Passport {
    var number: String
    var owner: Person? // strong reference

    init(number: String) {
        self.number = number
        print("Passport \(number) initialized")
    }

    deinit {
        print("Passport \(number) deinitialized")
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
var person: Person? = Person(name: "John")
var passport: Passport? = Passport(number: "12345")

person?.passport = passport
passport?.owner = person

// Reference count: person = 1, passport = 1
// –ö–æ–≥–¥–∞ –º—ã –æ–±–Ω—É–ª—è–µ–º —Å—Å—ã–ª–∫–∏:
person = nil    // person reference count = 0 ‚Üí deinit
passport = nil  // passport reference count = 0 ‚Üí deinit
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é

#### Retain Cycles (–¶–∏–∫–ª—ã —É–¥–µ—Ä–∂–∞–Ω–∏—è)
```swift
class A {
    var b: B?
    deinit { print("A deinitialized") }
}

class B {
    var a: A?
    deinit { print("B deinitialized") }
}

// –°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª —É–¥–µ—Ä–∂–∞–Ω–∏—è
let a = A()
let b = B()
a.b = b
b.a = a

// –ù–∏ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –ø–∞–º—è—Ç–∏!
// –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å weak –∏–ª–∏ unowned
class B {
    weak var a: A?  // —Å–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞
    deinit { print("B deinitialized") }
}
```

## Objective-C –∏ MRC

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ MRC
```objc
// –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
NSObject *obj = [[NSObject alloc] init];  // reference count = 1

// –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Å—Å—ã–ª–æ–∫
[obj retain];  // reference count = 2

// –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Å—Å—ã–ª–æ–∫
[obj release];  // reference count = 1

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
[obj autorelease];  // –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω release –ø–æ–∑–∂–µ
```

### –ü—Ä–∞–≤–∏–ª–∞ –≤–ª–∞–¥–µ–Ω–∏—è (Ownership Rules)
1. **Alloc/Init/New/Copy/MutableCopy** ‚Üí –≤–ª–∞–¥–µ–ª–µ—Ü –æ–±—ä–µ–∫—Ç–∞
2. **–î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã** ‚Üí autorelease –æ–±—ä–µ–∫—Ç

```objc
// –ü—Ä–∞–≤–∏–ª–æ 1: alloc/init —Å–æ–∑–¥–∞–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞
NSString *str1 = [[NSString alloc] initWithString:@"Hello"];
// –ù—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å [str1 release] –∏–ª–∏ [str1 autorelease]

// –ü—Ä–∞–≤–∏–ª–æ 2: –º–µ—Ç–æ–¥—ã –±–µ–∑ alloc –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç autorelease –æ–±—ä–µ–∫—Ç—ã
NSString *str2 = [NSString stringWithString:@"World"];
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ autorelease, –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–º—è—Ç—å—é
```

## Autorelease Pool

### –ß—Ç–æ —Ç–∞–∫–æ–µ Autorelease Pool?
**Autorelease Pool** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ Objective-C. –û–±—ä–µ–∫—Ç—ã, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ –∫–∞–∫ `autorelease`, –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—É–ª –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø—É–ª–∞.

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
```swift
// –í —Ü–∏–∫–ª–µ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
for i in 0..<10000 {
    @autoreleasepool {
        let data = try? Data(contentsOf: url)  // –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    }  // –ü—É–ª —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
}
```

### –í Swift
```swift
@autoreleasepool {
    // –ö–æ–¥, —Å–æ–∑–¥–∞—é—â–∏–π –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö Foundation –æ–±—ä–µ–∫—Ç–æ–≤
    let array = NSArray(array: [1, 2, 3])
    let string = NSString(string: "Hello")
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í Swift (ARC)
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ weak –¥–ª—è –¥–µ–ª–µ–≥–∞—Ç–æ–≤ –∏ –∑–∞–º—ã–∫–∞–Ω–∏–π**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ unowned —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –æ–±—ä–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç nil**
3. **–ò–∑–±–µ–≥–∞–π—Ç–µ —Ü–∏–∫–ª–æ–≤ —É–¥–µ—Ä–∂–∞–Ω–∏—è** –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ @autoreleasepool –≤ —Ü–∏–∫–ª–∞—Ö** —Å Foundation –æ–±—ä–µ–∫—Ç–∞–º–∏

### –í Objective-C (MRC)
1. **–°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞–º –≤–ª–∞–¥–µ–Ω–∏—è**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ @autoreleasepool –≤ —Ü–∏–∫–ª–∞—Ö**
3. **–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å—é**
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### Memory Graph Debugger
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –ü–æ–∏—Å–∫ —Ü–∏–∫–ª–æ–≤ —É–¥–µ—Ä–∂–∞–Ω–∏—è
- –ê–Ω–∞–ª–∏–∑ —Ü–µ–ø–æ—á–µ–∫ –≤–ª–∞–¥–µ–Ω–∏—è

### Instruments - Allocations
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
- –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ (Leaks)
- –ê–Ω–∞–ª–∏–∑ —Ä–æ—Å—Ç–∞ –ø–∞–º—è—Ç–∏

### Xcode Memory Debugger
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –ü–æ–∏—Å–∫ —Å–∏–ª—å–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
- –ê–Ω–∞–ª–∏–∑ retain/release –æ–ø–µ—Ä–∞—Ü–∏–π

## –í–æ–ø—Ä–æ—Å—ã —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π

### –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –í —á–µ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—è ARC –∏ MRC –∏ —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?
- –í –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç ARC –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–º —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç—å—é –∏ —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç?
- –ß—Ç–æ —Ç–∞–∫–æ–µ strong —Å—Å—ã–ª–∫–∞?
- –ß—Ç–æ —Ç–∞–∫–æ–µ retain cycle –∏ –∫–∞–∫ –µ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å?
- –°–ª—ã—à–∞–ª –ª–∏ —á—Ç–æ-—Ç–æ –ø—Ä–æ Autorelease pool?
- –ï—Å–ª–∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ —Ç–∞–∫–æ–µ MRC, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä retain cycle –∏ –∫–∞–∫ –µ–≥–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å weak/unowned —Å—Å—ã–ª–∫–∏?
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç @autoreleasepool –≤ Swift?
- –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è strong –æ—Ç weak —Å—Å—ã–ª–∫–∏?

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã
- [[autorelease-pool|Autorelease Pool]]
- [[memory-debugging|–û—Ç–ª–∞–¥–∫–∞ –ø–∞–º—è—Ç–∏]]
- [[retain-cycles|–¶–∏–∫–ª—ã —É–¥–µ—Ä–∂–∞–Ω–∏—è]]

## üìÖ –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π

### –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- **–î–∞—Ç–∞**: 2024-01-15
- **–í–µ—Ä—Å–∏—è**: iOS 17.2, Swift 5.9, Xcode 15.2
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏**:
  - [WWDC 2023: Improve app performance with SwiftUI](https://developer.apple.com/videos/play/wwdc2023/10169/)
  - [The Swift Programming Language](https://docs.swift.org/swift-book/LanguageGuide/MemorySafety.html)
  - [Automatic Reference Counting](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html)

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º Swift —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º (iOS 17+)
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é weak/unowned —Å—Å—ã–ª–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã retain cycles
- –£–ª—É—á—à–µ–Ω—ã –æ–±—ä—è—Å–Ω–µ–Ω–∏—è Objective-C MRC

### –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å async/await –∏ –ø–∞–º—è—Ç—å—é
- –û–±–Ω–æ–≤–∏—Ç—å –¥–ª—è iOS 18+ features
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
